#Fonction qui donne MTc en fonction de alpha, et l'output du training du svm en fonction des param
#SVM modèle prédictif: est-ce que je suis classifié correctement ou pas?
#Pour SVM: On peut faire 3 niveaux: Yes, No, Included
#COND: utilise-t-on priority_condition?
#COND_only: on ne prend que le GBD de condition field (et non pas les autres) pour la classification (et le training)
#output: modèle prédictif, en fonction des charact. de l'essai, est-ce qu'on peut être sûr de la classif donnée par le classifieur

training <- function(data,Mgbd,Egbd,MMap,MT,MTEB,alpha,wsd,gamma,cost,COND,COND_only){
#gamma et cost peuvent être des vecteurs, on fait un tune svm

NCTs <- as.character(data$PMID)

A <- Test_add_MT(NCTs,MMap,MT,MTEB,alpha)

#Si pas besoin d'ajout, création de MTc
if(A[[1]]) MTc <- A[[2]]
#Sinon, on renvoie la liste de concepts à classifier
else return(A[[3]])

#Characteristiques CUI
MC <- CUI_charac(Mgbd,Egbd,MMap, MTc)

#On fait le processing pour chaque essai pour wsd
i <- 1
NCT <- paste("pbky",NCTs[i],sep="")
D <- Trial_charac(Mgbd,Egbd,NCT,MMap,MC,wsd,COND)
for(i in 2:length(NCTs)){
NCT <- paste("pbky",NCTs[i],sep="")
D <- rbind(D,Trial_charac(Mgbd,Egbd,NCT,MMap,MC,wsd,COND))
}
D <- data.frame(D,row.names=NULL)
D <- cbind(D,Nb_mots_chp(data))

#SVM: WrongGBD or CorrectGBD
#Uncertainty: No si set equal, Included si intersection, Yes si erreur
tst <- strsplit(as.character(data$GBDnp),"&&")
#Cond_only
ifelse(COND_only,algo <- strsplit(as.character(D$cond_GBD),"&"),algo <- strsplit(as.character(D$Ess_GBD),"&"))
D$Unclear <- factor(unlist(lapply(1:nrow(data),function(x){	if(setequal(algo[[x]],tst[[x]])) return("No")
						else if(length(intersect(algo[[x]],tst[[x]]))>0) return("Included")
						else return("Yes")
						})))
#SVM model
mdl <- sup_vm(D,gamma,cost)

return(list(MTc,mdl))

}

